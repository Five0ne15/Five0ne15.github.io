{"title":"week2-test","uid":"863b4b95d25d05f1547152379537778b","slug":"week2-test","date":"2025-08-22T06:15:43.000Z","updated":"2025-09-02T07:47:56.973Z","comments":true,"path":"api/articles/week2-test.json","keywords":null,"cover":[],"content":"<h2 id=\"1、参考sqli-lab靶场优化第一周编写的cms，将注册功能，登录功能优化，新增修改密码功能\"><a href=\"#1、参考sqli-lab靶场优化第一周编写的cms，将注册功能，登录功能优化，新增修改密码功能\" class=\"headerlink\" title=\"1、参考sqli-lab靶场优化第一周编写的cms，将注册功能，登录功能优化，新增修改密码功能\"></a>1、参考sqli-lab靶场优化第一周编写的cms，将注册功能，登录功能优化，新增修改密码功能</h2><h3 id=\"注册功能\"><a href=\"#注册功能\" class=\"headerlink\" title=\"注册功能\"></a>注册功能</h3><p><code>mysqli_prepare()</code>: 这个函数用于准备一个SQL语句以供执行。它接收两个参数：数据库连接对象和SQL语句字符串（其中可以使用占位符<code>?</code>）。该函数返回一个语句对象（statement object），如果发生错误则返回<code>false</code>。</p>\n<p><code>mysqli_stmt_bind_param()</code>: 这个函数用于将变量绑定到预处理语句中的占位符（即<code>?</code>）。它需要至少三个参数：第一个参数是预处理语句对象。第二个参数是一个字符串，指定了后续变量的类型（如<code>s</code>表示字符串，<code>i</code>表示整数，<code>d</code>表示双精度浮点数，<code>b</code>表示二进制数据）。之后的参数是要绑定的变量，数量必须与预处理语句中的占位符数量一致。</p>\n<p><code>mysqli_stmt_execute()</code>: 执行预处理语句。它使用之前绑定的参数执行SQL语句。如果执行成功返回<code>true</code>，否则返回<code>false</code>。</p>\n<p><code>mysqli_stmt_store_result()</code>: 将预处理语句的结果集从服务器传输到客户端，并存储到语句对象中。这样后续就可以使用<code>mysqli_stmt_num_rows()</code>等函数来处理结果集。这个函数通常用于SELECT查询，以便在客户端获取结果集。</p>\n<p><code>mysqli_stmt_num_rows()</code>: 返回预处理语句结果集中的行数。注意，这个函数必须在<code>mysqli_stmt_store_result()</code>之后调用，否则可能无法正确获取行数。</p>\n<p><code>mysqli_stmt_close()</code>: 关闭预处理语句并释放相关资源。这是一个良好的习惯，可以及时释放服务器资源。</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;meta charset=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"variable\">$db_host</span> = <span class=\"string\">&quot;127.0.0.1&quot;</span>;</span><br><span class=\"line\"><span class=\"variable\">$db_user</span> = <span class=\"string\">&quot;root&quot;</span>;</span><br><span class=\"line\"><span class=\"variable\">$db_pass</span> = <span class=\"string\">&quot;root&quot;</span>;</span><br><span class=\"line\"><span class=\"variable\">$db_name</span> = <span class=\"string\">&quot;cms&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$link</span> = <span class=\"title function_ invoke__\">mysqli_connect</span>(<span class=\"variable\">$db_host</span>, <span class=\"variable\">$db_user</span>, <span class=\"variable\">$db_pass</span>, <span class=\"variable\">$db_name</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span>(<span class=\"title function_ invoke__\">mysqli_connect_errno</span>())&#123;</span><br><span class=\"line\">    <span class=\"keyword\">exit</span>(<span class=\"string\">&quot;[&quot;</span>.<span class=\"title function_ invoke__\">mysqli_connect_errno</span>().<span class=\"string\">&quot;] &quot;</span>.<span class=\"title function_ invoke__\">mysqli_connect_error</span>());</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$reg_id</span> = @<span class=\"variable\">$_POST</span>[<span class=\"string\">&#x27;reg_id&#x27;</span>];</span><br><span class=\"line\"><span class=\"variable\">$reg_username</span> = @<span class=\"variable\">$_POST</span>[<span class=\"string\">&#x27;reg_username&#x27;</span>];</span><br><span class=\"line\"><span class=\"variable\">$reg_password</span> = @<span class=\"variable\">$_POST</span>[<span class=\"string\">&#x27;reg_password&#x27;</span>];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">register</span>(<span class=\"params\"><span class=\"variable\">$link</span>, <span class=\"variable\">$reg_id</span>, <span class=\"variable\">$reg_username</span>, <span class=\"variable\">$reg_password</span></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 验证输入是否为空</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"keyword\">empty</span>(<span class=\"variable\">$reg_id</span>) || <span class=\"keyword\">empty</span>(<span class=\"variable\">$reg_username</span>) || <span class=\"keyword\">empty</span>(<span class=\"variable\">$reg_password</span>))&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&quot;请填写账号、用户名和密码！&quot;</span>;</span><br><span class=\"line\">        <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">// 检查ID是否已存在（使用参数化查询）</span></span><br><span class=\"line\">    <span class=\"variable\">$check_sql</span> = <span class=\"string\">&quot;SELECT id FROM user WHERE id = ?&quot;</span>;</span><br><span class=\"line\">    <span class=\"variable\">$stmt</span> = <span class=\"title function_ invoke__\">mysqli_prepare</span>(<span class=\"variable\">$link</span>, <span class=\"variable\">$check_sql</span>);</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">mysqli_stmt_bind_param</span>(<span class=\"variable\">$stmt</span>, <span class=\"string\">&quot;s&quot;</span>, <span class=\"variable\">$reg_id</span>);</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">mysqli_stmt_execute</span>(<span class=\"variable\">$stmt</span>);</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">mysqli_stmt_store_result</span>(<span class=\"variable\">$stmt</span>);</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"title function_ invoke__\">mysqli_stmt_num_rows</span>(<span class=\"variable\">$stmt</span>) &gt; <span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&quot;存在相同账号，请重新输入账号！&quot;</span>;</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">mysqli_stmt_close</span>(<span class=\"variable\">$stmt</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">mysqli_stmt_close</span>(<span class=\"variable\">$stmt</span>);</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">// 插入新用户（使用参数化查询）</span></span><br><span class=\"line\">    <span class=\"variable\">$insert_sql</span> = <span class=\"string\">&quot;INSERT INTO user (id, username, password) VALUES (?, ?, ?)&quot;</span>;</span><br><span class=\"line\">    <span class=\"variable\">$stmt</span> = <span class=\"title function_ invoke__\">mysqli_prepare</span>(<span class=\"variable\">$link</span>, <span class=\"variable\">$insert_sql</span>);</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">mysqli_stmt_bind_param</span>(<span class=\"variable\">$stmt</span>, <span class=\"string\">&quot;sss&quot;</span>, <span class=\"variable\">$reg_id</span>, <span class=\"variable\">$reg_username</span>, <span class=\"variable\">$reg_password</span>);</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"title function_ invoke__\">mysqli_stmt_execute</span>(<span class=\"variable\">$stmt</span>))&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&quot;注册成功！&quot;</span>;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&quot;注册失败: &quot;</span> . <span class=\"title function_ invoke__\">mysqli_error</span>(<span class=\"variable\">$link</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">mysqli_stmt_close</span>(<span class=\"variable\">$stmt</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title function_ invoke__\">register</span>(<span class=\"variable\">$link</span>, <span class=\"variable\">$reg_id</span>, <span class=\"variable\">$reg_username</span>, <span class=\"variable\">$reg_password</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"登录功能\"><a href=\"#登录功能\" class=\"headerlink\" title=\"登录功能\"></a>登录功能</h3><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$db_host</span> = <span class=\"string\">&quot;127.0.0.1&quot;</span>;</span><br><span class=\"line\"><span class=\"variable\">$db_user</span> = <span class=\"string\">&quot;root&quot;</span>;</span><br><span class=\"line\"><span class=\"variable\">$db_pass</span> = <span class=\"string\">&quot;root&quot;</span>;</span><br><span class=\"line\"><span class=\"variable\">$db_name</span> = <span class=\"string\">&quot;cms&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$link</span> = @<span class=\"title function_ invoke__\">mysqli_connect</span>(<span class=\"variable\">$db_host</span>, <span class=\"variable\">$db_user</span>, <span class=\"variable\">$db_pass</span>, <span class=\"variable\">$db_name</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span>(!<span class=\"variable\">$link</span>)&#123;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">exit</span>(<span class=\"string\">&quot;[&quot;</span>.<span class=\"title function_ invoke__\">mysqli_connect_errno</span>().<span class=\"string\">&quot;] &quot;</span>.<span class=\"title function_ invoke__\">mysqli_connect_error</span>());</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$log_id</span> = @<span class=\"variable\">$_POST</span>[<span class=\"string\">&#x27;log_id&#x27;</span>];</span><br><span class=\"line\"><span class=\"variable\">$log_password</span> = @<span class=\"variable\">$_POST</span>[<span class=\"string\">&#x27;log_password&#x27;</span>];</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">login</span>(<span class=\"params\"><span class=\"variable\">$link</span>, <span class=\"variable\">$log_id</span>, <span class=\"variable\">$log_password</span></span>)</span>&#123;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"variable\">$sql</span> = <span class=\"string\">&quot;SELECT id, password FROM user WHERE id = ?&quot;</span>; <span class=\"comment\">// 使用占位符?的SQL语句</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"variable\">$stmt</span> = <span class=\"title function_ invoke__\">mysqli_prepare</span>(<span class=\"variable\">$link</span>, <span class=\"variable\">$sql</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(!<span class=\"variable\">$stmt</span>)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&quot;数据库查询准备失败: &quot;</span> . <span class=\"title function_ invoke__\">mysqli_error</span>(<span class=\"variable\">$link</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"title function_ invoke__\">mysqli_stmt_bind_param</span>(<span class=\"variable\">$stmt</span>, <span class=\"string\">&quot;s&quot;</span>, <span class=\"variable\">$log_id</span>);</span><br><span class=\"line\">    </span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">if</span>(!<span class=\"title function_ invoke__\">mysqli_stmt_execute</span>(<span class=\"variable\">$stmt</span>))&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&quot;查询执行失败: &quot;</span> . <span class=\"title function_ invoke__\">mysqli_stmt_error</span>(<span class=\"variable\">$stmt</span>);</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">mysqli_stmt_close</span>(<span class=\"variable\">$stmt</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"title function_ invoke__\">mysqli_stmt_bind_result</span>(<span class=\"variable\">$stmt</span>, <span class=\"variable\">$db_id</span>, <span class=\"variable\">$db_password</span>);</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"title function_ invoke__\">mysqli_stmt_store_result</span>(<span class=\"variable\">$stmt</span>);</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"title function_ invoke__\">mysqli_stmt_num_rows</span>(<span class=\"variable\">$stmt</span>) == <span class=\"number\">1</span>)&#123;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"title function_ invoke__\">mysqli_stmt_fetch</span>(<span class=\"variable\">$stmt</span>);</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"variable\">$log_password</span> === <span class=\"variable\">$db_password</span>)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">echo</span> <span class=\"string\">&quot;登录成功!欢迎用户：&quot;</span>.<span class=\"variable\">$log_id</span>.<span class=\"string\">&quot; QAQ&quot;</span>;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">echo</span> <span class=\"string\">&quot;登录失败，密码错误!&quot;</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&quot;登录失败，用户不存在!&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"title function_ invoke__\">mysqli_stmt_close</span>(<span class=\"variable\">$stmt</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title function_ invoke__\">login</span>(<span class=\"variable\">$link</span>, <span class=\"variable\">$log_id</span>, <span class=\"variable\">$log_password</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"修改密码\"><a href=\"#修改密码\" class=\"headerlink\" title=\"修改密码\"></a>修改密码</h3><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>wuyifan<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">form</span> <span class=\"attr\">action</span>=<span class=\"string\">&quot;4.php&quot;</span> <span class=\"attr\">method</span>=<span class=\"string\">&quot;post&quot;</span> &gt;</span></span><br><span class=\"line\">    输入用户ID：<span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;change_id&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span></span><br><span class=\"line\">\t输入原密码：<span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;password&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;original_password&quot;</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span></span><br><span class=\"line\">    输入新密码：<span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;password&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;change_password&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span></span><br><span class=\"line\">\t确认新密码：<span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;password&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;check_change_password&quot;</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;submit&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;修改密码&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">form</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class=\"line\">&lt;?php</span><br><span class=\"line\"></span><br><span class=\"line\">$db_host = &quot;127.0.0.1&quot;;</span><br><span class=\"line\">$db_user = &quot;root&quot;;</span><br><span class=\"line\">$db_pass = &quot;root&quot;;</span><br><span class=\"line\">$db_name = &quot;cms&quot;;</span><br><span class=\"line\"></span><br><span class=\"line\">// 建立数据库连接</span><br><span class=\"line\">$link = @mysqli_connect($db_host, $db_user, $db_pass, $db_name);</span><br><span class=\"line\"></span><br><span class=\"line\">// 检查数据库连接是否成功</span><br><span class=\"line\">if(!$link)&#123;</span><br><span class=\"line\">    exit(&quot;[&quot;.mysqli_connect_errno().&quot;] &quot;.mysqli_connect_error());</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">// 获取前端传递的参数</span><br><span class=\"line\">$change_id = @$_POST[&#x27;change_id&#x27;];</span><br><span class=\"line\">$original_password = @$_POST[&#x27;original_password&#x27;];</span><br><span class=\"line\">$change_password = @$_POST[&#x27;change_password&#x27;];</span><br><span class=\"line\">$check_change_password = @$_POST[&#x27;check_change_password&#x27;];</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">function changePassword($link, $change_id, $original_password, $change_password, $check_change_password) &#123;</span><br><span class=\"line\">    // 第一步：验证必填字段是否为空</span><br><span class=\"line\">    if(empty($change_id) || empty($original_password) || empty($change_password) || empty($check_change_password)) &#123;</span><br><span class=\"line\">        echo &quot;所有字段都必须填写！&quot;;</span><br><span class=\"line\">        return;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    // 第二步：检查两次输入的新密码是否一致</span><br><span class=\"line\">    if($change_password !== $check_change_password) &#123;</span><br><span class=\"line\">        echo &quot;两次输入的新密码不一致！&quot;;</span><br><span class=\"line\">        return;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    // 第三步：检查用户是否存在并验证原始密码</span><br><span class=\"line\">    $check_sql = &quot;SELECT password FROM user WHERE id = ?&quot;;</span><br><span class=\"line\">    $stmt = mysqli_prepare($link, $check_sql);</span><br><span class=\"line\">    </span><br><span class=\"line\">    if(!$stmt) &#123;</span><br><span class=\"line\">        echo &quot;数据库查询准备失败: &quot; . mysqli_error($link);</span><br><span class=\"line\">        return;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    // 绑定参数并执行查询</span><br><span class=\"line\">    mysqli_stmt_bind_param($stmt, &quot;s&quot;, $change_id);</span><br><span class=\"line\">    mysqli_stmt_execute($stmt);</span><br><span class=\"line\">    mysqli_stmt_store_result($stmt);</span><br><span class=\"line\">    </span><br><span class=\"line\">    // 检查用户是否存在</span><br><span class=\"line\">    if(mysqli_stmt_num_rows($stmt) == 0) &#123;</span><br><span class=\"line\">        echo &quot;用户不存在！&quot;;</span><br><span class=\"line\">        mysqli_stmt_close($stmt);</span><br><span class=\"line\">        return;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    // 绑定结果变量</span><br><span class=\"line\">    mysqli_stmt_bind_result($stmt, $db_password);</span><br><span class=\"line\">    mysqli_stmt_fetch($stmt);</span><br><span class=\"line\">    mysqli_stmt_close($stmt);</span><br><span class=\"line\">    </span><br><span class=\"line\">    // 验证原始密码是否正确</span><br><span class=\"line\">    if($original_password !== $db_password) &#123;</span><br><span class=\"line\">        echo &quot;原始密码错误！&quot;;</span><br><span class=\"line\">        return;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    // 第四步：更新密码</span><br><span class=\"line\">    $update_sql = &quot;UPDATE user SET password = ? WHERE id = ?&quot;;</span><br><span class=\"line\">    $stmt = mysqli_prepare($link, $update_sql);</span><br><span class=\"line\">    </span><br><span class=\"line\">    if(!$stmt) &#123;</span><br><span class=\"line\">        echo &quot;更新准备失败: &quot; . mysqli_error($link);</span><br><span class=\"line\">        return;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    // 绑定参数并执行更新</span><br><span class=\"line\">    mysqli_stmt_bind_param($stmt, &quot;ss&quot;, $change_password, $change_id);</span><br><span class=\"line\">    </span><br><span class=\"line\">    if(mysqli_stmt_execute($stmt)) &#123;</span><br><span class=\"line\">        echo &quot;密码修改成功！&quot;;</span><br><span class=\"line\">    &#125; else &#123;</span><br><span class=\"line\">        echo &quot;密码修改失败: &quot; . mysqli_error($link);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    mysqli_stmt_close($stmt);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">// 调用修改密码函数</span><br><span class=\"line\">changePassword($link, $change_id, $original_password, $change_password, $check_change_password);</span><br><span class=\"line\"></span><br><span class=\"line\">?&gt;</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://cdn.jsdelivr.net/gh/Five0ne15/picgo_pic@main/picgo_picture/image-20250822165317687.png\" alt=\"image-20250822165317687\"></p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/Five0ne15/picgo_pic@main/picgo_picture/image-20250824195933111.png\" alt=\"image-20250824195933111\"></p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/Five0ne15/picgo_pic@main/picgo_picture/image-20250824195950376.png\" alt=\"image-20250824195950376\"></p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/Five0ne15/picgo_pic@main/picgo_picture/image-20250824200016087.png\" alt=\"image-20250824200016087\"></p>\n<h2 id=\"2、修复sqli-lab靶场的宽字节注入、万能密码、二次注入、堆叠注入\"><a href=\"#2、修复sqli-lab靶场的宽字节注入、万能密码、二次注入、堆叠注入\" class=\"headerlink\" title=\"2、修复sqli-lab靶场的宽字节注入、万能密码、二次注入、堆叠注入\"></a>2、修复sqli-lab靶场的宽字节注入、万能密码、二次注入、堆叠注入</h2><h3 id=\"宽字节注入\"><a href=\"#宽字节注入\" class=\"headerlink\" title=\"宽字节注入\"></a>宽字节注入</h3><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">check_addslashese</span>(<span class=\"params\"><span class=\"variable\">$string</span></span>) </span>&#123;</span><br><span class=\"line\">\t</span><br><span class=\"line\">    <span class=\"comment\">//删除可能导致宽字节注入的危险字符</span></span><br><span class=\"line\">    <span class=\"variable\">$dangerous_chars</span> = [</span><br><span class=\"line\">        <span class=\"string\">&#x27;%df&#x27;</span>, <span class=\"string\">&#x27;%bf&#x27;</span>, <span class=\"string\">&#x27;%5c&#x27;</span>, <span class=\"comment\">// 宽字节注入核心字符</span></span><br><span class=\"line\">        <span class=\"string\">&#x27;%27&#x27;</span>, <span class=\"string\">&#x27;%22&#x27;</span>,         <span class=\"comment\">// 单引号、双引号的URL编码</span></span><br><span class=\"line\">        <span class=\"string\">&#x27;\\&#x27;&#x27;</span>, <span class=\"string\">&#x27;&quot;&#x27;</span>,            <span class=\"comment\">// 引号本身</span></span><br><span class=\"line\">        <span class=\"string\">&#x27;\\\\&#x27;</span>,                 <span class=\"comment\">// 反斜杠</span></span><br><span class=\"line\">        <span class=\"string\">&#x27;--&#x27;</span>, <span class=\"string\">&#x27;/*&#x27;</span>, <span class=\"string\">&#x27;*/&#x27;</span>,     <span class=\"comment\">// SQL注释符</span></span><br><span class=\"line\">        <span class=\"string\">&#x27;;&#x27;</span>,                  <span class=\"comment\">// SQL语句分隔符</span></span><br><span class=\"line\">        <span class=\"string\">&quot;\\0&quot;</span>, <span class=\"string\">&quot;\\x1a&quot;</span>,         <span class=\"comment\">// NULL字节和文件结束符</span></span><br><span class=\"line\">        <span class=\"string\">&quot;\\r&quot;</span>, <span class=\"string\">&quot;\\n&quot;</span>,           <span class=\"comment\">// 换行符（可能用于日志污染）</span></span><br><span class=\"line\">        <span class=\"string\">&#x27;=&#x27;</span>                   <span class=\"comment\">// 等号（可能用于SQL条件注入）</span></span><br><span class=\"line\">    ];</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"variable\">$string</span> = <span class=\"title function_ invoke__\">str_replace</span>(<span class=\"variable\">$dangerous_chars</span>, <span class=\"string\">&#x27;&#x27;</span>, <span class=\"variable\">$string</span>);</span><br><span class=\"line\">    </span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"variable\">$string</span> = <span class=\"title function_ invoke__\">preg_replace</span>(<span class=\"string\">&#x27;/\\\\\\\\/&#x27;</span>, <span class=\"string\">&quot;\\\\\\\\\\\\\\\\&quot;</span>, <span class=\"variable\">$string</span>);    <span class=\"comment\">// 转义反斜杠</span></span><br><span class=\"line\">    <span class=\"variable\">$string</span> = <span class=\"title function_ invoke__\">preg_replace</span>(<span class=\"string\">&#x27;/\\&#x27;/&#x27;</span>, <span class=\"string\">&quot;\\\\&#x27;&quot;</span>, <span class=\"variable\">$string</span>);           <span class=\"comment\">// 转义单引号</span></span><br><span class=\"line\">    <span class=\"variable\">$string</span> = <span class=\"title function_ invoke__\">preg_replace</span>(<span class=\"string\">&#x27;/\\&quot;/&#x27;</span>, <span class=\"string\">&quot;\\\\\\&quot;&quot;</span>, <span class=\"variable\">$string</span>);           <span class=\"comment\">// 转义双引号</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    </span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"variable\">$string</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>再次输入<code>?id=111%df&#39; union select 1,2,3 --+</code>，不能使用宽字节注入</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/Five0ne15/picgo_pic@main/picgo_picture/image-20250824201606320.png\" alt=\"image-20250824201606320\"></p>\n<h3 id=\"万能密码\"><a href=\"#万能密码\" class=\"headerlink\" title=\"万能密码\"></a>万能密码</h3><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$uname</span>=<span class=\"variable\">$_POST</span>[<span class=\"string\">&#x27;uname&#x27;</span>];</span><br><span class=\"line\">\t<span class=\"variable\">$uname</span> = <span class=\"title function_ invoke__\">preg_replace</span>(</span><br><span class=\"line\">        <span class=\"string\">&#x27;/</span></span><br><span class=\"line\"><span class=\"string\">        (?:^|\\s)         # 匹配开头或空格</span></span><br><span class=\"line\"><span class=\"string\">        \\&#x27;               # 单引号</span></span><br><span class=\"line\"><span class=\"string\">        \\s*              # 可选空格</span></span><br><span class=\"line\"><span class=\"string\">        or               # or关键字（不区分大小写）</span></span><br><span class=\"line\"><span class=\"string\">        \\s*              # 可选空格</span></span><br><span class=\"line\"><span class=\"string\">        \\&#x27;?              # 可选单引号</span></span><br><span class=\"line\"><span class=\"string\">        1                # 数字1</span></span><br><span class=\"line\"><span class=\"string\">        \\s*              # 可选空格</span></span><br><span class=\"line\"><span class=\"string\">        \\&#x27;?              # 可选单引号</span></span><br><span class=\"line\"><span class=\"string\">        \\s*              # 可选空格</span></span><br><span class=\"line\"><span class=\"string\">        =                # 等号</span></span><br><span class=\"line\"><span class=\"string\">        \\s*              # 可选空格</span></span><br><span class=\"line\"><span class=\"string\">        \\&#x27;?              # 可选单引号</span></span><br><span class=\"line\"><span class=\"string\">        1                # 数字1</span></span><br><span class=\"line\"><span class=\"string\">        \\s*              # 可选空格</span></span><br><span class=\"line\"><span class=\"string\">        (\\#|--|;)?       # 可选注释符（#、--或;）</span></span><br><span class=\"line\"><span class=\"string\">        (?:[\\s\\&#x27;\\&quot;]*)?   # 可选空格或引号</span></span><br><span class=\"line\"><span class=\"string\">        (?:\\s|$)         # 确保后面是空格或结束</span></span><br><span class=\"line\"><span class=\"string\">        /ix&#x27;</span>, </span><br><span class=\"line\">        <span class=\"string\">&#x27;&#x27;</span>,</span><br><span class=\"line\">        <span class=\"variable\">$uname</span></span><br><span class=\"line\">    );</span><br><span class=\"line\">\t<span class=\"variable\">$passwd</span>=<span class=\"variable\">$_POST</span>[<span class=\"string\">&#x27;passwd&#x27;</span>];</span><br></pre></td></tr></table></figure>\n\n<p>修改之前：</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/Five0ne15/picgo_pic@main/picgo_picture/image-20250824203255613.png\" alt=\"image-20250824203255613\"></p>\n<p>修改之后：</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/Five0ne15/picgo_pic@main/picgo_picture/image-20250824203317811.png\" alt=\"image-20250824203317811\"></p>\n<h3 id=\"二次注入\"><a href=\"#二次注入\" class=\"headerlink\" title=\"二次注入\"></a>二次注入</h3><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$raw_username</span> = <span class=\"variable\">$_POST</span>[<span class=\"string\">&#x27;username&#x27;</span>];</span><br><span class=\"line\">    <span class=\"variable\">$pass</span> = <span class=\"variable\">$_POST</span>[<span class=\"string\">&#x27;password&#x27;</span>];</span><br><span class=\"line\">    <span class=\"variable\">$re_pass</span> = <span class=\"variable\">$_POST</span>[<span class=\"string\">&#x27;re_password&#x27;</span>];</span><br><span class=\"line\">    </span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"title function_ invoke__\">preg_match</span>(<span class=\"string\">&#x27;/[^a-zA-Z0-9]/&#x27;</span>, <span class=\"variable\">$raw_username</span>)) &#123;</span><br><span class=\"line\">        <span class=\"meta\">?&gt;</span></span><br><span class=\"line\">        &lt;script&gt;</span><br><span class=\"line\">            <span class=\"title function_ invoke__\">alert</span>(<span class=\"string\">&quot;用户名不允许存在特殊符号！&quot;</span>);</span><br><span class=\"line\">            <span class=\"title function_ invoke__\">setTimeout</span>(function() &#123;</span><br><span class=\"line\">                window.location.href = <span class=\"string\">&#x27;new_user.php&#x27;</span>;</span><br><span class=\"line\">            &#125;, <span class=\"number\">1000</span>);</span><br><span class=\"line\">        &lt;/script&gt;</span><br><span class=\"line\">        <span class=\"meta\">&lt;?php</span></span><br><span class=\"line\">        <span class=\"keyword\">exit</span>();</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<p>禁止注册带有特殊符号的用户名</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/Five0ne15/picgo_pic@main/picgo_picture/image-20250824210952355.png\" alt=\"image-20250824210952355\"></p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/Five0ne15/picgo_pic@main/picgo_picture/image-20250824211211290.png\" alt=\"image-20250824211211290\"></p>\n<h3 id=\"堆叠注入\"><a href=\"#堆叠注入\" class=\"headerlink\" title=\"堆叠注入\"></a>堆叠注入</h3><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"title function_ invoke__\">strpos</span>(<span class=\"variable\">$id</span>, <span class=\"string\">&#x27;;&#x27;</span>) !== <span class=\"literal\">false</span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 直接终止并返回错误（避免执行后续SQL）</span></span><br><span class=\"line\">    <span class=\"title function_ invoke__\">http_response_code</span>(<span class=\"number\">400</span>);</span><br><span class=\"line\">    <span class=\"keyword\">exit</span>(<span class=\"string\">&quot;非法请求：检测到堆叠注入攻击&quot;</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>在传来id参数后，若id参数有分号，直接报错</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/Five0ne15/picgo_pic@main/picgo_picture/image-20250824211737573.png\" alt=\"image-20250824211737573\"></p>\n<h2 id=\"3、尝试挖掘自己cms网页的sql注入漏洞，编写渗透测试报告并修复漏洞\"><a href=\"#3、尝试挖掘自己cms网页的sql注入漏洞，编写渗透测试报告并修复漏洞\" class=\"headerlink\" title=\"3、尝试挖掘自己cms网页的sql注入漏洞，编写渗透测试报告并修复漏洞\"></a>3、尝试挖掘自己cms网页的sql注入漏洞，编写渗透测试报告并修复漏洞</h2><h2 id=\"4、针对testfire-net网页进行渗透测试，编写渗透测试报告，全流程\"><a href=\"#4、针对testfire-net网页进行渗透测试，编写渗透测试报告，全流程\" class=\"headerlink\" title=\"4、针对testfire.net网页进行渗透测试，编写渗透测试报告，全流程\"></a>4、针对testfire.net网页进行渗透测试，编写渗透测试报告，全流程</h2><h2 id=\"5、画图描述对称加密与非对称加密的流程\"><a href=\"#5、画图描述对称加密与非对称加密的流程\" class=\"headerlink\" title=\"5、画图描述对称加密与非对称加密的流程\"></a>5、画图描述对称加密与非对称加密的流程</h2><p><img src=\"https://cdn.jsdelivr.net/gh/Five0ne15/picgo_pic@main/picgo_picture/%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86.jpg\" alt=\"对称加密\"></p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/Five0ne15/picgo_pic@main/picgo_picture/%E9%9D%9E%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86.jpg\" alt=\"非对称加密\"></p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/Five0ne15/picgo_pic@main/picgo_picture/%E8%AF%81%E4%B9%A6.jpg\" alt=\"证书\"></p>\n","text":"1、参考sqli-lab靶场优化第一周编写的cms，将注册功能，登录功能优化，新增修改密码功能注册功能mysqli_prepare(): 这个函数用于准备一个S...","permalink":"/post/week2-test","photos":[],"count_time":{"symbolsCount":"10k","symbolsTime":"9 mins."},"categories":[],"tags":[{"name":"练习","slug":"练习","count":14,"path":"api/tags/练习.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#1%E3%80%81%E5%8F%82%E8%80%83sqli-lab%E9%9D%B6%E5%9C%BA%E4%BC%98%E5%8C%96%E7%AC%AC%E4%B8%80%E5%91%A8%E7%BC%96%E5%86%99%E7%9A%84cms%EF%BC%8C%E5%B0%86%E6%B3%A8%E5%86%8C%E5%8A%9F%E8%83%BD%EF%BC%8C%E7%99%BB%E5%BD%95%E5%8A%9F%E8%83%BD%E4%BC%98%E5%8C%96%EF%BC%8C%E6%96%B0%E5%A2%9E%E4%BF%AE%E6%94%B9%E5%AF%86%E7%A0%81%E5%8A%9F%E8%83%BD\"><span class=\"toc-text\">1、参考sqli-lab靶场优化第一周编写的cms，将注册功能，登录功能优化，新增修改密码功能</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%B3%A8%E5%86%8C%E5%8A%9F%E8%83%BD\"><span class=\"toc-text\">注册功能</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E7%99%BB%E5%BD%95%E5%8A%9F%E8%83%BD\"><span class=\"toc-text\">登录功能</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E4%BF%AE%E6%94%B9%E5%AF%86%E7%A0%81\"><span class=\"toc-text\">修改密码</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#2%E3%80%81%E4%BF%AE%E5%A4%8Dsqli-lab%E9%9D%B6%E5%9C%BA%E7%9A%84%E5%AE%BD%E5%AD%97%E8%8A%82%E6%B3%A8%E5%85%A5%E3%80%81%E4%B8%87%E8%83%BD%E5%AF%86%E7%A0%81%E3%80%81%E4%BA%8C%E6%AC%A1%E6%B3%A8%E5%85%A5%E3%80%81%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5\"><span class=\"toc-text\">2、修复sqli-lab靶场的宽字节注入、万能密码、二次注入、堆叠注入</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%AE%BD%E5%AD%97%E8%8A%82%E6%B3%A8%E5%85%A5\"><span class=\"toc-text\">宽字节注入</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E4%B8%87%E8%83%BD%E5%AF%86%E7%A0%81\"><span class=\"toc-text\">万能密码</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E4%BA%8C%E6%AC%A1%E6%B3%A8%E5%85%A5\"><span class=\"toc-text\">二次注入</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5\"><span class=\"toc-text\">堆叠注入</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#3%E3%80%81%E5%B0%9D%E8%AF%95%E6%8C%96%E6%8E%98%E8%87%AA%E5%B7%B1cms%E7%BD%91%E9%A1%B5%E7%9A%84sql%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E%EF%BC%8C%E7%BC%96%E5%86%99%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E6%8A%A5%E5%91%8A%E5%B9%B6%E4%BF%AE%E5%A4%8D%E6%BC%8F%E6%B4%9E\"><span class=\"toc-text\">3、尝试挖掘自己cms网页的sql注入漏洞，编写渗透测试报告并修复漏洞</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#4%E3%80%81%E9%92%88%E5%AF%B9testfire-net%E7%BD%91%E9%A1%B5%E8%BF%9B%E8%A1%8C%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%EF%BC%8C%E7%BC%96%E5%86%99%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E6%8A%A5%E5%91%8A%EF%BC%8C%E5%85%A8%E6%B5%81%E7%A8%8B\"><span class=\"toc-text\">4、针对testfire.net网页进行渗透测试，编写渗透测试报告，全流程</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#5%E3%80%81%E7%94%BB%E5%9B%BE%E6%8F%8F%E8%BF%B0%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86%E4%B8%8E%E9%9D%9E%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86%E7%9A%84%E6%B5%81%E7%A8%8B\"><span class=\"toc-text\">5、画图描述对称加密与非对称加密的流程</span></a></li></ol>","author":{"name":"wyf","slug":"blog-author","avatar":"https://cdn.jsdelivr.net/gh/Five0ne15/picgo_pic@main/picgo_picture/18ca1dd2a86b2210b1ab142498bcf0b0.jpg","link":"/","description":"不知道应该写点什么，就这么看着吧","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"hidden":false,"prev_post":{"title":"XSS攻击","uid":"1cc67b731b39ffe2f01ec906867d987d","slug":"XSS攻击","date":"2025-08-25T03:00:17.000Z","updated":"2025-08-25T03:23:39.186Z","comments":true,"path":"api/articles/XSS攻击.json","keywords":null,"cover":[],"text":"XSS攻击核心概念 本质： XSS 攻击允许攻击者将恶意的客户端脚本代码（通常是 JavaScript） 注入到其他用户会访问的网页中。 目标： 当受害者的浏览...","permalink":"/post/XSS攻击","photos":[],"count_time":{"symbolsCount":"4.4k","symbolsTime":"4 mins."},"categories":[],"tags":[{"name":"Web","slug":"Web","count":5,"path":"api/tags/Web.json"}],"author":{"name":"wyf","slug":"blog-author","avatar":"https://cdn.jsdelivr.net/gh/Five0ne15/picgo_pic@main/picgo_picture/18ca1dd2a86b2210b1ab142498bcf0b0.jpg","link":"/","description":"不知道应该写点什么，就这么看着吧","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"day09-test","uid":"521513d1964f32727f98c554936ae859","slug":"day09-test","date":"2025-08-21T10:43:36.000Z","updated":"2025-09-02T07:47:06.441Z","comments":true,"path":"api/articles/day09-test.json","keywords":null,"cover":[],"text":"1、使用手工注入的方式写入一句话木马一般来说，MySQL不允许文件的写入，想要执行写入一句话木马的效果，需要修改配置文件my.ini，在后面加上secure_f...","permalink":"/post/day09-test","photos":[],"count_time":{"symbolsCount":"3.3k","symbolsTime":"3 mins."},"categories":[],"tags":[{"name":"练习","slug":"练习","count":14,"path":"api/tags/练习.json"}],"author":{"name":"wyf","slug":"blog-author","avatar":"https://cdn.jsdelivr.net/gh/Five0ne15/picgo_pic@main/picgo_picture/18ca1dd2a86b2210b1ab142498bcf0b0.jpg","link":"/","description":"不知道应该写点什么，就这么看着吧","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}