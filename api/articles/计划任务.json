{"title":"计划任务","uid":"3e7fe2ca73cd20125c7985e6b77d8968","slug":"计划任务","date":"2025-08-06T07:24:48.000Z","updated":"2025-08-06T12:26:29.464Z","comments":true,"path":"api/articles/计划任务.json","keywords":null,"cover":[],"content":"<h1 id=\"计划任务\"><a href=\"#计划任务\" class=\"headerlink\" title=\"计划任务\"></a>计划任务</h1><h2 id=\"一、-计划任务概述\"><a href=\"#一、-计划任务概述\" class=\"headerlink\" title=\"一、 计划任务概述\"></a>一、 计划任务概述</h2><h3 id=\"1-1-什么是计划任务？\"><a href=\"#1-1-什么是计划任务？\" class=\"headerlink\" title=\"1.1 什么是计划任务？\"></a>1.1 什么是计划任务？</h3><p>​\t定义：在特定时间自动执行预先设定的命令或脚本。</p>\n<p>​\t核心用途：</p>\n<p>​\t\t延迟执行（如30秒后重启服务）。</p>\n<p>​\t\t周期性任务（如每日备份数据库、每小时同步数据）。</p>\n<p>​\t\t脱机任务（如无人值守服务器运维）。</p>\n<h3 id=\"1-2-Linux中的两大工具\"><a href=\"#1-2-Linux中的两大工具\" class=\"headerlink\" title=\"1.2 Linux中的两大工具\"></a>1.2 Linux中的两大工具</h3><p><img src=\"https://cdn.jsdelivr.net/gh/Five0ne15/picgo_pic@main/picgo_picture/image-20250806194846350.png\" alt=\"image-20250806194846350\"></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@wyf 桌面]# systemctl status atd.service </span><br><span class=\"line\">● atd.service - Job spooling tools</span><br><span class=\"line\">   Loaded: loaded (/usr/lib/systemd/system/atd.service; enabled; vendor preset:&gt;</span><br><span class=\"line\">   Active: active (running) since Wed 2025-08-06 15:30:49 CST; 4h 18min ago</span><br><span class=\"line\"> Main PID: 1421 (atd)</span><br><span class=\"line\">    Tasks: 1 (<span class=\"built_in\">limit</span>: 23821)</span><br><span class=\"line\">   Memory: 688.0K</span><br><span class=\"line\">   CGroup: /system.slice/atd.service</span><br><span class=\"line\">           └─1421 /usr/sbin/atd -f</span><br><span class=\"line\"></span><br><span class=\"line\">8月 06 15:30:49 wyf systemd[1]: Started Job spooling tools.</span><br><span class=\"line\"></span><br><span class=\"line\">[root@wyf 桌面]# systemctl status crond.service </span><br><span class=\"line\">● crond.service - Command Scheduler</span><br><span class=\"line\">   Loaded: loaded (/usr/lib/systemd/system/crond.service; enabled; vendor prese&gt;</span><br><span class=\"line\">   Active: active (running) since Wed 2025-08-06 15:30:49 CST; 4h 18min ago</span><br><span class=\"line\"> Main PID: 1423 (crond)</span><br><span class=\"line\">    Tasks: 1 (<span class=\"built_in\">limit</span>: 23821)</span><br><span class=\"line\">   Memory: 2.8M</span><br><span class=\"line\">   CGroup: /system.slice/crond.service</span><br><span class=\"line\">           └─1423 /usr/sbin/crond -n</span><br><span class=\"line\"></span><br><span class=\"line\">8月 06 16:01:02 wyf CROND[3215]: (root) CMD (run-parts /etc/cron.hourly)</span><br><span class=\"line\">8月 06 16:01:02 wyf anacron[3224]: Anacron started on 2025-08-06</span><br><span class=\"line\">8月 06 16:01:02 wyf anacron[3224]: Will run job `cron.daily<span class=\"string\">&#x27; in 10 min.</span></span><br><span class=\"line\"><span class=\"string\">8月 06 16:01:02 wyf anacron[3224]: Jobs will be executed sequentially</span></span><br><span class=\"line\"><span class=\"string\">8月 06 16:11:02 wyf anacron[3224]: Job `cron.daily&#x27;</span> started</span><br><span class=\"line\">8月 06 16:11:02 wyf anacron[3224]: Job `cron.daily<span class=\"string\">&#x27; terminated</span></span><br><span class=\"line\"><span class=\"string\">8月 06 16:11:02 wyf anacron[3224]: Normal exit (1 job run)</span></span><br><span class=\"line\"><span class=\"string\">8月 06 17:01:01 wyf CROND[3892]: (root) CMD (run-parts /etc/cron.hourly)</span></span><br><span class=\"line\"><span class=\"string\">8月 06 18:01:01 wyf CROND[4464]: (root) CMD (run-parts /etc/cron.hourly)</span></span><br><span class=\"line\"><span class=\"string\">8月 06 19:01:01 wyf CROND[5973]: (root) CMD (run-parts /etc/cron.hourly)</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"二、at-命令详解\"><a href=\"#二、at-命令详解\" class=\"headerlink\" title=\"二、at 命令详解\"></a>二、at 命令详解</h2><h3 id=\"2-1-基本语法\"><a href=\"#2-1-基本语法\" class=\"headerlink\" title=\"2.1 基本语法\"></a>2.1 基本语法</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">at [选项] 时间表达式 [命令]</span><br></pre></td></tr></table></figure>\n\n<p>​\t提交任务：输入命令后按 Ctrl+D 提交。</p>\n<p>​\t查看任务：atq（列出所有任务）。</p>\n<p>​\t删除任务：atrm &lt;任务ID&gt;。</p>\n<h3 id=\"2-2-时间表达式\"><a href=\"#2-2-时间表达式\" class=\"headerlink\" title=\"2.2 时间表达式\"></a>2.2 时间表达式</h3><p>​\t灵活时间格式：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">now        <span class=\"comment\"># 立即执行  </span></span><br><span class=\"line\">now + 5min  <span class=\"comment\"># 5分钟后</span></span><br><span class=\"line\">02:30 tomorrow/today  <span class=\"comment\"># 次日2:30</span></span><br><span class=\"line\">2025-12-31 23:59  <span class=\"comment\"># 绝对时间</span></span><br></pre></td></tr></table></figure>\n\n<p>​\t示例：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@wyf 桌面]# at now +1 minutes</span><br><span class=\"line\">warning: commands will be executed using /bin/sh</span><br><span class=\"line\"><span class=\"comment\">#该警告意味着计划任务必须使用内置命令</span></span><br></pre></td></tr></table></figure>\n\n<p>​\t显示加载</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@wyf 桌面]# at now +1 minutes</span><br><span class=\"line\">warning: commands will be executed using /bin/sh</span><br><span class=\"line\">at&gt; SHELL=/bin/bash</span><br><span class=\"line\">at&gt; <span class=\"built_in\">echo</span> <span class=\"string\">&quot;当前shell：  <span class=\"subst\">$(which bash)</span>&quot;</span> &gt;&gt; /tmp/at-test.txt</span><br><span class=\"line\">at&gt; &lt;EOT&gt;                                                  <span class=\"comment\"># Ctrl D 退出</span></span><br><span class=\"line\">job 1 at Wed Aug  6 19:53:00 2025</span><br><span class=\"line\">[root@wyf ~]# <span class=\"built_in\">cd</span> /tmp</span><br><span class=\"line\">[root@wyf tmp]# <span class=\"built_in\">pwd</span></span><br><span class=\"line\">/tmp</span><br><span class=\"line\">[root@wyf tmp]# <span class=\"built_in\">cat</span> at-test.txt</span><br><span class=\"line\">当前shell：  /usr/bin/bash</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-3-实战场景入门\"><a href=\"#2-3-实战场景入门\" class=\"headerlink\" title=\"2.3 实战场景入门\"></a>2.3 实战场景入门</h3><h4 id=\"场景1：延迟执行高风险操作-删除\"><a href=\"#场景1：延迟执行高风险操作-删除\" class=\"headerlink\" title=\"场景1：延迟执行高风险操作-删除\"></a>场景1：延迟执行高风险操作-删除</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@wyf tmp]# at now +1 minutes</span><br><span class=\"line\">warning: commands will be executed using /bin/sh</span><br><span class=\"line\">at&gt; <span class=\"built_in\">rm</span> -rf /tmp/at-test.txt</span><br><span class=\"line\">at&gt; &lt;EOT&gt;</span><br><span class=\"line\">job 2 at Wed Aug  6 19:59:00 2025</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"场景2：固定时间任务-每天凌晨2点备份数据库\"><a href=\"#场景2：固定时间任务-每天凌晨2点备份数据库\" class=\"headerlink\" title=\"场景2：固定时间任务-每天凌晨2点备份数据库\"></a>场景2：固定时间任务-每天凌晨2点备份数据库</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@wyf ~]# at 02:00 tomorrow</span><br><span class=\"line\">warning: commands will be executed using /bin/sh</span><br><span class=\"line\">at&gt; tar -zcf /backup/db_$(<span class=\"built_in\">date</span> +%F).tar.gz /var/lib/mysql</span><br><span class=\"line\">at&gt; &lt;EOT&gt;</span><br><span class=\"line\">job 2 at Wed Aug  6 19:59:40 2025</span><br></pre></td></tr></table></figure>\n\n<p> date命令解释：</p>\n<p>​\tdate 的格式化符号以 % 开头，后接特定字母表示不同时间单位。以下是常用符号及其含义：</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/Five0ne15/picgo_pic@main/picgo_picture/image-20250806195757186.png\" alt=\"image-20250806195757186\"></p>\n<h4 id=\"场景3：复杂时间格式\"><a href=\"#场景3：复杂时间格式\" class=\"headerlink\" title=\"场景3：复杂时间格式\"></a>场景3：复杂时间格式</h4><p>​\t<strong>支持灵活时间描述</strong>：</p>\n<p>​\t\tnow：立即执行</p>\n<p>​\t\ttoday &#x2F; tomorrow：当天&#x2F;次日</p>\n<p>​\t\tYYYY-MM-DD HH:MM：绝对时间</p>\n<p>​\t\t+N days &#x2F; -N minutes：相对时间</p>\n<p>​\t<strong>示例</strong>：</p>\n<p>​\t\t2025年12月25日23:59执行关机：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">at 23:59 Dec 25 2025</span><br><span class=\"line\">shutdown -h now</span><br><span class=\"line\">Ctrl+D 提交</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-4-管理命令\"><a href=\"#2-4-管理命令\" class=\"headerlink\" title=\"2.4 管理命令\"></a>2.4 管理命令</h3><p><img src=\"https://cdn.jsdelivr.net/gh/Five0ne15/picgo_pic@main/picgo_picture/image-20250806200055753.png\" alt=\"image-20250806200055753\"></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@wyf tmp]# atq</span><br><span class=\"line\">[root@wyf tmp]# at now +5 minutes</span><br><span class=\"line\">warning: commands will be executed using /bin/sh</span><br><span class=\"line\">at&gt; <span class=\"built_in\">touch</span> /tmp/5</span><br><span class=\"line\">at&gt; &lt;EOT&gt;</span><br><span class=\"line\">job 3 at Wed Aug  6 20:06:00 2025</span><br><span class=\"line\">[root@wyf tmp]# atq</span><br><span class=\"line\">3\tWed Aug  6 20:06:00 2025 a root</span><br><span class=\"line\">[root@wyf tmp]# at -c 3</span><br><span class=\"line\"><span class=\"comment\">#!/bin/sh</span></span><br><span class=\"line\"><span class=\"comment\"># atrun uid=0 gid=0</span></span><br><span class=\"line\"><span class=\"comment\"># mail root 0</span></span><br><span class=\"line\"><span class=\"built_in\">umask</span> 22</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"三、-cron命令详解\"><a href=\"#三、-cron命令详解\" class=\"headerlink\" title=\"三、 cron命令详解\"></a>三、 cron命令详解</h2><h3 id=\"3-1-cron-核心功能\"><a href=\"#3-1-cron-核心功能\" class=\"headerlink\" title=\"3.1 cron 核心功能\"></a>3.1 cron 核心功能</h3><p>cron 是 Linux&#x2F;Unix 系统中用于周期性执行任务的守护进程，适合以下场景：</p>\n<p>​\t<strong>定时备份</strong>：每日&#x2F;每周自动备份数据。</p>\n<p>​\t<strong>日志清理</strong>：定时删除过期日志文件。</p>\n<p>​\t<strong>数据同步</strong>：每小时同步服务器间数据。</p>\n<p>​\t<strong>监控报警</strong>：检测服务状态并发送通知。</p>\n<h3 id=\"3-2-配置文件\"><a href=\"#3-2-配置文件\" class=\"headerlink\" title=\"3.2 配置文件\"></a>3.2 配置文件</h3><p>​\t<strong>系统级</strong>：&#x2F;etc&#x2F;crontab 编辑模板（所有用户生效）。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@wyf etc]# <span class=\"built_in\">cat</span> crontab </span><br><span class=\"line\">SHELL=/bin/bash</span><br><span class=\"line\">PATH=/sbin:/bin:/usr/sbin:/usr/bin</span><br><span class=\"line\">MAILTO=root</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># For details see man 4 crontabs</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Example of job definition:</span></span><br><span class=\"line\"><span class=\"comment\"># .---------------- minute (0 - 59)</span></span><br><span class=\"line\"><span class=\"comment\"># |  .------------- hour (0 - 23)</span></span><br><span class=\"line\"><span class=\"comment\"># |  |  .---------- day of month (1 - 31)</span></span><br><span class=\"line\"><span class=\"comment\"># |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...</span></span><br><span class=\"line\"><span class=\"comment\"># |  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat</span></span><br><span class=\"line\"><span class=\"comment\"># |  |  |  |  |</span></span><br><span class=\"line\"><span class=\"comment\"># *  *  *  *  * user-name  command to be executed</span></span><br></pre></td></tr></table></figure>\n\n<p>​\t语法格式：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">* * * * * 用户名 命令</span><br><span class=\"line\">分钟 小时 日 月 星期</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3-3-时间表达式\"><a href=\"#3-3-时间表达式\" class=\"headerlink\" title=\"3.3 时间表达式\"></a>3.3 时间表达式</h3><p>​\t字段说明：</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/Five0ne15/picgo_pic@main/picgo_picture/image-20250806200452437.png\" alt=\"image-20250806200452437\"></p>\n<p>​\t示例：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">0 2 * * * root /usr/bin/systemctl restart nginx    <span class=\"comment\">#每日凌晨2点重启Nginx</span></span><br><span class=\"line\">30 4 * * 1-5 user1 /home/user1/backup.sh           <span class=\"comment\"># 工作日每天4:30备份</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3-4-管理命令详解\"><a href=\"#3-4-管理命令详解\" class=\"headerlink\" title=\"3.4 管理命令详解\"></a>3.4 管理命令详解</h3><p>crontab 是 cron 的配置工具，用于安装、删除、编辑用户的计划任务。以下是常用命令：</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/Five0ne15/picgo_pic@main/picgo_picture/image-20250806200553854.png\" alt=\"image-20250806200553854\"></p>\n<h4 id=\"1-crontab-e：编辑任务\"><a href=\"#1-crontab-e：编辑任务\" class=\"headerlink\" title=\"1.  crontab -e：编辑任务\"></a>1.  crontab -e：编辑任务</h4><p>​\t<strong>功能：</strong></p>\n<p>​\t\t打开当前用户的 ~&#x2F;.crontab 文件，支持 vi 或 nano 编辑器（取决于系统默认）。</p>\n<p>​\t<strong>使用场景：</strong> </p>\n<p>​\t\t添加、修改或删除个人定时任务。</p>\n<p>​\t示例：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 添加每日备份任务</span></span><br><span class=\"line\">crontab -e</span><br><span class=\"line\">0 3 * * * <span class=\"built_in\">touch</span> /tmp/test2.txt</span><br></pre></td></tr></table></figure>\n\n<p>​\t保存退出后，任务自动生效。</p>\n<h4 id=\"2-crontab-l：列出任务\"><a href=\"#2-crontab-l：列出任务\" class=\"headerlink\" title=\"2.  crontab -l：列出任务\"></a>2.  crontab -l：列出任务</h4><p>​\t<strong>功能：</strong> </p>\n<p>​\t\t显示当前用户的所有计划任务（格式化输出）。 </p>\n<p>​\t示例：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@wyf ~]# crontab -l</span><br><span class=\"line\">0 3 * * * <span class=\"built_in\">touch</span> /tmp/test2.txt</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"3-crontab-r：删除任务\"><a href=\"#3-crontab-r：删除任务\" class=\"headerlink\" title=\"3.  crontab -r：删除任务\"></a>3.  crontab -r：删除任务</h4><p>​\t<strong>功能：</strong> </p>\n<p>​\t\t永久删除当前用户的所有计划任务。 </p>\n<p>​\t示例：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">crontab -r</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"4-crontab-u-username：管理其他用户\"><a href=\"#4-crontab-u-username：管理其他用户\" class=\"headerlink\" title=\"4. crontab -u username：管理其他用户\"></a>4. crontab -u username：管理其他用户</h4><p>​\t<strong>功能：</strong></p>\n<p>​\t\t\t需要 sudo 权限，用于查看&#x2F;编辑其他用户的任务。</p>\n<p>​\t示例：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@wyf ~]# crontab -u user777 -e</span><br><span class=\"line\">no crontab <span class=\"keyword\">for</span> user777 - using an empty one</span><br><span class=\"line\">crontab: installing new crontab</span><br><span class=\"line\">[root@wyf ~]# crontab -u user777 -l</span><br><span class=\"line\">0 3 * * * <span class=\"built_in\">touch</span> /tmp/user777</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3-5-使用方法\"><a href=\"#3-5-使用方法\" class=\"headerlink\" title=\"3.5 使用方法\"></a>3.5 使用方法</h3><h4 id=\"场景1：每两个月的工作日的凌晨3点打包备份日志-var-log-secure\"><a href=\"#场景1：每两个月的工作日的凌晨3点打包备份日志-var-log-secure\" class=\"headerlink\" title=\"场景1：每两个月的工作日的凌晨3点打包备份日志&#x2F;var&#x2F;log&#x2F;secure\"></a>场景1：每两个月的工作日的凌晨3点打包备份日志&#x2F;var&#x2F;log&#x2F;secure</h4><p>可以在&#x2F;etc&#x2F;crontab中直接编辑，也可以使用命令crontab -e 进行编辑</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 编辑用户级crontab</span></span><br><span class=\"line\">crontab -e</span><br><span class=\"line\"><span class=\"comment\"># 添加任务（每天3:00执行）</span></span><br><span class=\"line\">0 3 * 1，3，5，7，9，11 1-5 root tar -zcf /tmp/log.tar.gz /var/log/secure</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#该命令执行后的效果有两个问题</span></span><br><span class=\"line\">1.tar打包命令最好使用相对路径</span><br><span class=\"line\"><span class=\"comment\">#修改</span></span><br><span class=\"line\">0 3 * 1，3，5，7，9，11 1-5 root <span class=\"built_in\">cd</span> /var/log;tar -zcf /tmp/log.tar.gz secure</span><br><span class=\"line\"><span class=\"comment\">#使用&#x27;;&#x27;分割两条命令</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">[root@wyf ~]# <span class=\"built_in\">date</span></span><br><span class=\"line\">2025年 08月 06日 星期三 20:13:49 CST</span><br><span class=\"line\">[root@wyf ~]# crontab -e</span><br><span class=\"line\">* 20 6 8 * root <span class=\"built_in\">cd</span> /var/log;tar -zcf /tmp/log.tar.gz secure</span><br><span class=\"line\">no crontab <span class=\"keyword\">for</span> root - using an empty one</span><br><span class=\"line\">crontab: installing new crontab</span><br><span class=\"line\">[root@wyf tmp]# ll | grep log.tar.gz</span><br><span class=\"line\">-rw-r--r--. 1 root root   45 8月   6 20:15 log.tar.gz</span><br><span class=\"line\">[root@wyf tmp]# ll | grep log.tar.gz</span><br><span class=\"line\">-rw-r--r--. 1 root root   45 8月   6 20:16 log.tar.gz</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#修改</span></span><br><span class=\"line\">[root@wyf tmp]# <span class=\"built_in\">touch</span> logs`<span class=\"built_in\">date</span> +%H:%M`.txt</span><br><span class=\"line\">[root@wyf tmp]# <span class=\"built_in\">ls</span> | grep logs</span><br><span class=\"line\">logs20:16.txt</span><br><span class=\"line\">[root@wyf tmp]# crontab -e</span><br><span class=\"line\">* 20 6 8 * root <span class=\"built_in\">cd</span> /var/log;tar -zcf /tmp/log`<span class=\"built_in\">date</span> +\\%H:\\%M`.tar.gz secure</span><br><span class=\"line\">crontab: installing new crontab</span><br><span class=\"line\">[root@wyf tmp]# ll | grep <span class=\"built_in\">log</span></span><br><span class=\"line\">-rw-r--r--. 1 root root 2066 7月  28 19:41 anaconda.log</span><br><span class=\"line\">-rw-r--r--. 1 root root 2604 7月  28 19:40 dbus.log</span><br><span class=\"line\">-rw-r--r--. 1 root root    0 7月  28 19:40 ifcfg.log</span><br><span class=\"line\">-rw-r--r--. 1 root root    0 8月   6 20:16 logs20:16.txt</span><br><span class=\"line\">-rw-r--r--. 1 root root   45 8月   6 20:17 log.tar.gz</span><br><span class=\"line\">-rw-r--r--. 1 root root    0 7月  28 19:40 packaging.log</span><br><span class=\"line\">-rw-r--r--. 1 root root  131 7月  28 19:40 program.log</span><br><span class=\"line\">-rw-r--r--. 1 root root    0 7月  28 19:40 sensitive-info.log</span><br><span class=\"line\">-rw-r--r--. 1 root root    0 7月  28 19:40 storage.log</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"四、-at-vs-cron对比分析\"><a href=\"#四、-at-vs-cron对比分析\" class=\"headerlink\" title=\"四、 at vs cron对比分析\"></a>四、 at vs cron对比分析</h2><p><img src=\"https://cdn.jsdelivr.net/gh/Five0ne15/picgo_pic@main/picgo_picture/image-20250806201900318.png\" alt=\"image-20250806201900318\"></p>\n<h2 id=\"五、-总结与实战案例\"><a href=\"#五、-总结与实战案例\" class=\"headerlink\" title=\"五、 总结与实战案例\"></a>五、 总结与实战案例</h2><h3 id=\"5-1-关键总结\"><a href=\"#5-1-关键总结\" class=\"headerlink\" title=\"5.1 关键总结\"></a>5.1 关键总结</h3><p>​\tat ：适合一次性任务（如临时重启服务、延迟执行敏感操作）。</p>\n<p>​\tcron ：适合长期周期任务（如每日备份、定时监控）。</p>\n<h3 id=\"5-2-综合案例：自动化运维\"><a href=\"#5-2-综合案例：自动化运维\" class=\"headerlink\" title=\"5.2 综合案例：自动化运维\"></a>5.2 综合案例：自动化运维</h3><p>​\t<strong>需求：</strong></p>\n<p>​\t\t每日凌晨2点备份网站数据到远程服务器。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">0 2 * * * root ./linux.sh</span><br></pre></td></tr></table></figure>\n\n<p>​\t\t每小时检查服务器磁盘使用率，超过90%时发邮件报警。</p>\n<p><strong>解决方案</strong>：github搜索脚本，按时运行！</p>\n<p>​\t1.使用 cron 备份：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">0 2 * * * rsync -avz /www/user123.com/ user@remote:/backup/</span><br></pre></td></tr></table></figure>\n\n<p>​\t2.使用 at 发送报警：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 每小时检查磁盘</span></span><br><span class=\"line\">0 * * * * <span class=\"built_in\">df</span> -h | grep /dev/sda1 | awk <span class=\"string\">&#x27;&#123;print $5&#125;&#x27;</span> | <span class=\"keyword\">while</span> <span class=\"built_in\">read</span> -r usage; </span><br><span class=\"line\"><span class=\"keyword\">do</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> [ <span class=\"string\">&quot;<span class=\"variable\">$usage</span>&quot;</span> -gt 90 ]; <span class=\"keyword\">then</span></span><br><span class=\"line\"> \t\tat now + 5 minutes -t Asia/Shanghai</span><br><span class=\"line\"> \t\tmail -s <span class=\"string\">&quot;Disk Alert!&quot;</span> admin@example.com &lt;&lt;&lt; <span class=\"string\">&quot;Disk usage on /dev/sda1 is </span></span><br><span class=\"line\"><span class=\"string\"><span class=\"variable\">$usage</span>%&quot;</span></span><br><span class=\"line\">\t<span class=\"keyword\">fi</span></span><br><span class=\"line\"><span class=\"keyword\">done</span></span><br></pre></td></tr></table></figure>\n\n","feature":true,"text":"计划任务一、 计划任务概述1.1 什么是计划任务？​ 定义：在特定时间自动执行预先设定的命令或脚本。 ​ 核心用途： ​ 延迟执行（如30秒后重启服务）。 ​ ...","permalink":"/post/计划任务","photos":[],"count_time":{"symbolsCount":"7.2k","symbolsTime":"7 mins."},"categories":[],"tags":[{"name":"Linux","slug":"Linux","count":13,"path":"api/tags/Linux.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1\"><span class=\"toc-text\">计划任务</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%B8%80%E3%80%81-%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1%E6%A6%82%E8%BF%B0\"><span class=\"toc-text\">一、 计划任务概述</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#1-1-%E4%BB%80%E4%B9%88%E6%98%AF%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1%EF%BC%9F\"><span class=\"toc-text\">1.1 什么是计划任务？</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#1-2-Linux%E4%B8%AD%E7%9A%84%E4%B8%A4%E5%A4%A7%E5%B7%A5%E5%85%B7\"><span class=\"toc-text\">1.2 Linux中的两大工具</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%BA%8C%E3%80%81at-%E5%91%BD%E4%BB%A4%E8%AF%A6%E8%A7%A3\"><span class=\"toc-text\">二、at 命令详解</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#2-1-%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95\"><span class=\"toc-text\">2.1 基本语法</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#2-2-%E6%97%B6%E9%97%B4%E8%A1%A8%E8%BE%BE%E5%BC%8F\"><span class=\"toc-text\">2.2 时间表达式</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#2-3-%E5%AE%9E%E6%88%98%E5%9C%BA%E6%99%AF%E5%85%A5%E9%97%A8\"><span class=\"toc-text\">2.3 实战场景入门</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%9C%BA%E6%99%AF1%EF%BC%9A%E5%BB%B6%E8%BF%9F%E6%89%A7%E8%A1%8C%E9%AB%98%E9%A3%8E%E9%99%A9%E6%93%8D%E4%BD%9C-%E5%88%A0%E9%99%A4\"><span class=\"toc-text\">场景1：延迟执行高风险操作-删除</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%9C%BA%E6%99%AF2%EF%BC%9A%E5%9B%BA%E5%AE%9A%E6%97%B6%E9%97%B4%E4%BB%BB%E5%8A%A1-%E6%AF%8F%E5%A4%A9%E5%87%8C%E6%99%A82%E7%82%B9%E5%A4%87%E4%BB%BD%E6%95%B0%E6%8D%AE%E5%BA%93\"><span class=\"toc-text\">场景2：固定时间任务-每天凌晨2点备份数据库</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%9C%BA%E6%99%AF3%EF%BC%9A%E5%A4%8D%E6%9D%82%E6%97%B6%E9%97%B4%E6%A0%BC%E5%BC%8F\"><span class=\"toc-text\">场景3：复杂时间格式</span></a></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#2-4-%E7%AE%A1%E7%90%86%E5%91%BD%E4%BB%A4\"><span class=\"toc-text\">2.4 管理命令</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%B8%89%E3%80%81-cron%E5%91%BD%E4%BB%A4%E8%AF%A6%E8%A7%A3\"><span class=\"toc-text\">三、 cron命令详解</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#3-1-cron-%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD\"><span class=\"toc-text\">3.1 cron 核心功能</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#3-2-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6\"><span class=\"toc-text\">3.2 配置文件</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#3-3-%E6%97%B6%E9%97%B4%E8%A1%A8%E8%BE%BE%E5%BC%8F\"><span class=\"toc-text\">3.3 时间表达式</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#3-4-%E7%AE%A1%E7%90%86%E5%91%BD%E4%BB%A4%E8%AF%A6%E8%A7%A3\"><span class=\"toc-text\">3.4 管理命令详解</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#1-crontab-e%EF%BC%9A%E7%BC%96%E8%BE%91%E4%BB%BB%E5%8A%A1\"><span class=\"toc-text\">1.  crontab -e：编辑任务</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#2-crontab-l%EF%BC%9A%E5%88%97%E5%87%BA%E4%BB%BB%E5%8A%A1\"><span class=\"toc-text\">2.  crontab -l：列出任务</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#3-crontab-r%EF%BC%9A%E5%88%A0%E9%99%A4%E4%BB%BB%E5%8A%A1\"><span class=\"toc-text\">3.  crontab -r：删除任务</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#4-crontab-u-username%EF%BC%9A%E7%AE%A1%E7%90%86%E5%85%B6%E4%BB%96%E7%94%A8%E6%88%B7\"><span class=\"toc-text\">4. crontab -u username：管理其他用户</span></a></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#3-5-%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95\"><span class=\"toc-text\">3.5 使用方法</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%9C%BA%E6%99%AF1%EF%BC%9A%E6%AF%8F%E4%B8%A4%E4%B8%AA%E6%9C%88%E7%9A%84%E5%B7%A5%E4%BD%9C%E6%97%A5%E7%9A%84%E5%87%8C%E6%99%A83%E7%82%B9%E6%89%93%E5%8C%85%E5%A4%87%E4%BB%BD%E6%97%A5%E5%BF%97-var-log-secure\"><span class=\"toc-text\">场景1：每两个月的工作日的凌晨3点打包备份日志&#x2F;var&#x2F;log&#x2F;secure</span></a></li></ol></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%9B%9B%E3%80%81-at-vs-cron%E5%AF%B9%E6%AF%94%E5%88%86%E6%9E%90\"><span class=\"toc-text\">四、 at vs cron对比分析</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%BA%94%E3%80%81-%E6%80%BB%E7%BB%93%E4%B8%8E%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B\"><span class=\"toc-text\">五、 总结与实战案例</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#5-1-%E5%85%B3%E9%94%AE%E6%80%BB%E7%BB%93\"><span class=\"toc-text\">5.1 关键总结</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#5-2-%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B%EF%BC%9A%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4\"><span class=\"toc-text\">5.2 综合案例：自动化运维</span></a></li></ol></li></ol></li></ol>","author":{"name":"wyf","slug":"blog-author","avatar":"https://cdn.jsdelivr.net/gh/Five0ne15/picgo_pic@main/picgo_picture/18ca1dd2a86b2210b1ab142498bcf0b0.jpg","link":"/","description":"不知道应该写点什么，就这么看着吧","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"hidden":false,"prev_post":{"title":"网络管理","uid":"211ca85a2e196056b84f487853fdec80","slug":"网络管理","date":"2025-08-07T02:21:43.000Z","updated":"2025-08-07T09:37:38.759Z","comments":true,"path":"api/articles/网络管理.json","keywords":null,"cover":[],"text":"网络管理一、基本概念1、物理网卡（NIC, Network Interface Card）​ 硬件实体：插在主板或扩展槽上的设备（如 Intel千兆网卡、Rea...","permalink":"/post/网络管理","photos":[],"count_time":{"symbolsCount":"18k","symbolsTime":"16 mins."},"categories":[],"tags":[{"name":"Linux","slug":"Linux","count":13,"path":"api/tags/Linux.json"}],"author":{"name":"wyf","slug":"blog-author","avatar":"https://cdn.jsdelivr.net/gh/Five0ne15/picgo_pic@main/picgo_picture/18ca1dd2a86b2210b1ab142498bcf0b0.jpg","link":"/","description":"不知道应该写点什么，就这么看着吧","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"feature":true},"next_post":{"title":"进程管理","uid":"d655af595b90ac0e0949f931f50e7fe8","slug":"进程管理","date":"2025-08-06T02:29:29.000Z","updated":"2025-08-06T12:24:32.966Z","comments":true,"path":"api/articles/进程管理.json","keywords":null,"cover":[],"text":"进程管理一、进程是什么？ 定义： 进程是正在执行的程序实例。当程序被加载到内存中运行时，操作系统会为其分配资源（CPU、内存、文件等），形成一个独立的执行单元。...","permalink":"/post/进程管理","photos":[],"count_time":{"symbolsCount":"19k","symbolsTime":"18 mins."},"categories":[],"tags":[{"name":"Linux","slug":"Linux","count":13,"path":"api/tags/Linux.json"}],"author":{"name":"wyf","slug":"blog-author","avatar":"https://cdn.jsdelivr.net/gh/Five0ne15/picgo_pic@main/picgo_picture/18ca1dd2a86b2210b1ab142498bcf0b0.jpg","link":"/","description":"不知道应该写点什么，就这么看着吧","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}